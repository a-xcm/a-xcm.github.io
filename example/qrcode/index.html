<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QRCodeKit 测试</title>
    <style>
        /* 重置样式 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* 基础样式 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
        }
        
        /* 响应式容器 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* 区块样式 */
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* 标题样式 */
        h1 {
            color: #333;
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding: 10px 0;
        }
        
        h2 {
            color: #555;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        h3 {
            color: #666;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        /* 测试项 */
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #fafafa;
        }
        
        .test-item:hover {
            border-color: #4CAF50;
            background-color: #f8fff8;
        }
        
        /* 输入框和文件选择 */
        input[type="text"], input[type="file"] {
            padding: 10px;
            width: 100%;
            max-width: 300px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        /* 按钮样式 */
        button {
            padding: 10px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        /* 二维码容器 */
        .qrcode-container {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #e0e0e0;
            display: inline-block;
            background-color: white;
        }
        
        /* 视频容器 */
        #video-container {
            margin: 15px 0;
            width: 100%;
            max-width: 400px;
        }
        
        /* 结果显示 */
        .result {
            margin-top: 10px;
            padding: 12px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }
        
        .error {
            margin-top: 10px;
            padding: 12px;
            background-color: #ffebee;
            color: #c62828;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .success {
            margin-top: 10px;
            padding: 12px;
            background-color: #e8f5e8;
            color: #2e7d32;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        /* 兼容性检测网格 */
        .compatibility {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .compatibility-item {
            padding: 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .compatibility-item.supported {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .compatibility-item.unsupported {
            background-color: #ffebee;
            color: #c62828;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 5px;
            }
            
            .section {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            h2 {
                font-size: 1.1rem;
            }
            
            input[type="text"], input[type="file"] {
                max-width: 100%;
                margin-right: 0;
            }
            
            button {
                width: 100%;
                max-width: 200px;
            }
            
            .test-item {
                padding: 10px;
            }
            
            #video-container {
                max-width: 100%;
            }
            
            .compatibility {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.2rem;
            }
            
            h2 {
                font-size: 1rem;
            }
            
            .test-item {
                padding: 8px;
            }
            
            input[type="text"], input[type="file"] {
                padding: 8px;
                font-size: 0.85rem;
            }
            
            button {
                padding: 8px 12px;
                font-size: 0.85rem;
                max-width: 100%;
            }
            
            .compatibility {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QRCodeKit 功能测试</h1>
        
        <!-- 兼容性检测 -->
        <div class="section">
            <h2>1. 兼容性检测</h2>
            <button onclick="testCompatibility()">检测兼容性</button>
            <div id="compatibility-result" class="compatibility"></div>
        </div>
        
        <!-- 二维码生成测试 -->
        <div class="section">
            <h2>2. 二维码生成测试</h2>
            
            <div class="test-item">
                <h3>基本生成</h3>
                <input type="text" id="qrcode-text" placeholder="输入二维码内容" value="https://www.example.com">
                <button onclick="generateQRCode()">生成二维码</button>
                <div id="basic-qrcode" class="qrcode-container"></div>
                <button onclick="clearQRCode()">清除</button>
                <button onclick="getDataURL()">获取DataURL</button>
                <div id="basic-result" class="result"></div>
            </div>
            
            <div class="test-item">
                <h3>自定义样式</h3>
                <input type="text" id="custom-text" placeholder="输入二维码内容" value="自定义样式测试">
                <button onclick="generateCustomQRCode()">生成自定义二维码</button>
                <div id="custom-qrcode" class="qrcode-container"></div>
                <div id="custom-result" class="result"></div>
            </div>
        </div>
        
        <!-- 图片解析测试 -->
        <div class="section">
            <h2>3. 图片二维码解析测试</h2>
            
            <div class="test-item">
                <h3>从文件解析</h3>
                <input type="file" id="image-file" accept="image/*">
                <button onclick="parseFromFile()">解析图片</button>
                <div id="file-result" class="result"></div>
            </div>
            
            <div class="test-item">
                <h3>从URL解析</h3>
                <input type="text" id="image-url" placeholder="输入图片URL" value="./qrcode-sample.png">
                <button onclick="parseFromURL()">解析URL</button>
                <div id="url-result" class="result"></div>
            </div>
        </div>
        
        <!-- 摄像头扫描测试 -->
        <div class="section">
            <h2>4. 摄像头扫描测试</h2>
            
            <div class="test-item">
                <h3>实时扫描</h3>
                <button onclick="toggleScanner()">开始扫描</button>
                <div id="video-container"></div>
                <div id="scan-result" class="result"></div>
            </div>
        </div>
    </div>
    
    <!-- 引入必要的库 -->
    <script src="./qrcode.min.js"></script>
    <script src="./jsQR.js"></script>
    <script src="./index.js"></script>
    
    <script>
        let qrcodeInstance = null;
        let customQrcodeInstance = null;
        let scannerInstance = null;
        let isScanning = false;
        
        // 检测兼容性
        function testCompatibility() {
            const result = QRCodeKit.util.checkCompatibility();
            const container = document.getElementById('compatibility-result');
            
            container.innerHTML = '';
            
            Object.entries(result).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = `compatibility-item ${value ? 'supported' : 'unsupported'}`;
                item.textContent = `${key}: ${value ? '支持' : '不支持'}`;
                container.appendChild(item);
            });
        }
        
        // 生成基本二维码
        function generateQRCode() {
            const text = document.getElementById('qrcode-text').value;
            const container = document.getElementById('basic-qrcode');
            const resultDiv = document.getElementById('basic-result');
            
            try {
                if (qrcodeInstance) {
                    qrcodeInstance.makeCode(text);
                } else {
                    qrcodeInstance = QRCodeKit.create(container, {
                        width: 200,
                        height: 200,
                        text: text
                    });
                }
                resultDiv.className = 'result success';
                resultDiv.textContent = '二维码生成成功！';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `错误: ${error.message}`;
            }
        }
        
        // 清除二维码
        function clearQRCode() {
            if (qrcodeInstance) {
                qrcodeInstance.clear();
                document.getElementById('basic-result').textContent = '二维码已清除';
            }
        }
        
        // 获取DataURL
        function getDataURL() {
            if (qrcodeInstance) {
                const dataURL = qrcodeInstance.toDataURL();
                const resultDiv = document.getElementById('basic-result');
                resultDiv.className = 'result';
                resultDiv.textContent = dataURL;
            }
        }
        
        // 生成自定义样式二维码
        function generateCustomQRCode() {
            const text = document.getElementById('custom-text').value;
            const container = document.getElementById('custom-qrcode');
            const resultDiv = document.getElementById('custom-result');
            
            try {
                if (customQrcodeInstance) {
                    customQrcodeInstance.makeCode(text);
                } else {
                    customQrcodeInstance = QRCodeKit.create(container, {
                        width: 200,
                        height: 200,
                        text: text,
                        colorDark: '#336699',
                        colorLight: '#f0f0f0',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
                resultDiv.className = 'result success';
                resultDiv.textContent = '自定义二维码生成成功！';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `错误: ${error.message}`;
            }
        }
        
        // 从文件解析
        async function parseFromFile() {
            const fileInput = document.getElementById('image-file');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('file-result');
            
            if (!file) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '请选择图片文件';
                return;
            }
            
            try {
                const result = await QRCodeKit.util.parseFromImage(file);
                resultDiv.className = 'result success';
                resultDiv.textContent = `解析结果: ${result}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `错误: ${error.message}`;
            }
        }
        
        // 从URL解析
        async function parseFromURL() {
            const url = document.getElementById('image-url').value;
            const resultDiv = document.getElementById('url-result');
            
            try {
                const result = await QRCodeKit.util.parseFromImage(url);
                resultDiv.className = 'result success';
                resultDiv.textContent = `解析结果: ${result}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `错误: ${error.message}`;
            }
        }
        
        // 切换扫描器
        function toggleScanner() {
            const button = event.target;
            const resultDiv = document.getElementById('scan-result');
            
            if (!isScanning) {
                startScanner(button, resultDiv);
            } else {
                stopScanner(button, resultDiv);
            }
        }
        
        // 开始扫描
        function startScanner(button, resultDiv) {
            if (!scannerInstance) {
                scannerInstance = QRCodeKit.scanner();
            }
            
            const videoContainer = document.getElementById('video-container');
            
            scannerInstance.start(
                (data) => {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `扫描结果: ${data}`;
                    isScanning = false;
                    button.textContent = '开始扫描';
                },
                videoContainer,
                {
                    videoWidth: '400px',
                    videoHeight: '400px',
                    scanInterval: 500
                }
            ).then(() => {
                isScanning = true;
                button.textContent = '停止扫描';
                resultDiv.className = 'result';
                resultDiv.textContent = '正在扫描...';
            }).catch(error => {
                resultDiv.className = 'result error';
                resultDiv.textContent = `错误: ${error.message}`;
            });
        }
        
        // 停止扫描
        function stopScanner(button, resultDiv) {
            if (scannerInstance) {
                scannerInstance.stop();
                isScanning = false;
                button.textContent = '开始扫描';
                resultDiv.className = 'result';
                resultDiv.textContent = '扫描已停止';
            }
        }
        
        // 页面加载完成后检测兼容性
        window.addEventListener('DOMContentLoaded', () => {
            testCompatibility();
        });
    </script>
</body>
</html>
